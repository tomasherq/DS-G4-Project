# A docker-compose must always start by the version tag.
version: "3.9"

# Define services
services:

  client1:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type client --ID 1 --BID 2 --mode publisher
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.1

  broker2:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type broker --ID 2 --NB 3
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.2

  broker3:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type broker --ID 3 --NB 2,4,5
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.3

  broker4:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type broker --ID 4 --NB 3
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.4

  broker5:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type broker --ID 5 --NB 3
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.5

  client6:
    # Path of Dockerfile
    build: .
    # The command to execute once the image is created.
    command: java -jar ./target/DS-Project-V1.0.0-jar-with-dependencies.jar --type client --ID 6 --BID 4 --mode subscriber
    volumes:
      - ${DIRECTORY_SAVE}:/tmp
    networks:
      broker_network:
        ipv4_address: 192.168.2.6
    # Port
    # Its syntax is as follows: [port we want on our machine]:[port we want to retrieve in the container]


# Set up custom network
networks:
  broker_network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 192.168.0.0/16
          gateway: 192.168.1.1